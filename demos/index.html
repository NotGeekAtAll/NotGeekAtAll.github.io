<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<title>picker</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<h1 id="text"></h1>
	<div class="picker-wrap">
		<div class="picker-toolbar">
			<button>取消</button>
			<button id="confirm">确认</button>
		</div>
		<div class="picker-column">
			<div class="up"></div>
			<div class="down"></div>
			<div class="line"></div>
			<ul id="scrollArea">
			</ul>
		</div>
	</div>

	<script>
		window.onload = function() {

			var scrollArea = document.getElementById('scrollArea'),
				startY = 0,
				lastOffset = 0,
				limit = 40,
				itemHeight = 0,
				doms = '<li></li><li></li>',
				options = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];

			for(var i = 0; i < options.length; i++) {
				doms += '<li>'+options[i]+'</li>'
			}	

			scrollArea.innerHTML = doms

			scrollArea.addEventListener("scroll", function(e) {
				e.preventDefault();
			}, false)

			scrollArea.addEventListener("touchstart", function(e) {
				e.preventDefault();
				startY = e.targetTouches[0].pageY
				itemHeight = document.querySelector(".picker-column ul li").clientHeight
			}, false)

			scrollArea.addEventListener("touchmove", function(e) {
				e.preventDefault();

				var offset = e.targetTouches[0].pageY - startY,
					distance = offset + lastOffset
				if ( distance > limit) {
					distance = limit
				} 

				if ( distance < -((options.length - 1) * itemHeight + limit)) {
					distance = -((options.length - 1) * itemHeight + limit)
				}

				scrollArea.style.transform = 'translate3d(0, '+distance+'px, 0)'
			}, false)

			scrollArea.addEventListener("touchend", function(e) {

				lastOffset += e.changedTouches[0].clientY - startY

				if (lastOffset > 0) {
					lastOffset = 0
				}

				if ( Math.abs(lastOffset) % 36 !== 0) {
					lastOffset = -(parseInt(Math.abs(lastOffset) / itemHeight) * itemHeight)
				}

				if ( lastOffset < -((options.length - 1) * itemHeight)) {
					lastOffset = -((options.length - 1) * itemHeight)
				}

				if (lastOffset > 0) return
				scrollArea.style.transform = 'translate3d(0, '+lastOffset+'px, 0)'
			}, false)

			document.querySelector("#confirm").addEventListener("touchstart", function(e) {
				e.preventDefault();

				var index = Math.abs(lastOffset/itemHeight)
				document.querySelector("#text").innerHTML = '您选择了第'+(index+1)+'项'+options[index]
			}, false)
		}
	</script>
</body>
</html>