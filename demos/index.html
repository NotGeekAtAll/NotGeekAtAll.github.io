<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<title>picker</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<h1 id="text"></h1>
	<div class="picker-wrap">
		<div class="picker-toolbar">
			<button>取消</button>
			<button id="confirm">确认</button>
		</div>
		<div class="picker-column">
			<div class="up"></div>
			<div class="down"></div>
			<div class="line"></div>
			<ul>
			</ul>
		</div>
	</div>

	<script>
		window.onload = function() {


			var scrollArea = document.querySelector(".picker-column ul"),
				startY = 0,
				lastOffset = 0,
				limit = 40,
				doms = '<li></li><li></li>',
				options = [1,2,3,4,5,6,8,7,9,10,11,12,13,14,15,16,17,18,19,20];

			for(let i = 0; i < options.length; i++) {
				doms += `<li>${options[i]}</li>`
			}	

			scrollArea.innerHTML = doms

			scrollArea.addEventListener("touchstart", function(e) {
				e.stopPropagation()
				startY = e.targetTouches[0].pageY

			}, false)

			scrollArea.addEventListener("touchmove", function(e) {
				e.stopPropagation()

				var offset = e.targetTouches[0].pageY - startY,
					distance = offset + lastOffset
				if ( distance > limit) {
					distance = limit
				} 

				if ( distance < -((options.length - 1) * 36 + limit)) {
					distance = -((options.length - 1) * 36 + limit)
				}

				scrollArea.style.transform = `translate3d(0, ${distance}px, 0)`
			}, false)

			scrollArea.addEventListener("touchend", function(e) {
				e.stopPropagation()

				lastOffset += e.changedTouches[0].clientY - startY

				if (lastOffset > 0) {
					lastOffset = 0
				}

				if ( Math.abs(lastOffset) % 36 !== 0) {
					lastOffset = -(parseInt(Math.abs(lastOffset) / 36) * 36)
				}

				if ( lastOffset < -((options.length - 1) * 36)) {
					lastOffset = -((options.length - 1) * 36)
				}

				if (lastOffset > 0) return
				scrollArea.style.transform = `translate3d(0, ${lastOffset}px, 0)`
			}, false)

			document.querySelector("#confirm").addEventListener("click", function() {
				e.stopPropagation()

				var index = Math.abs(lastOffset/36)
				document.querySelector("#text").innerHTML = `您选择了第${index+1}项${options[index]}`
			}, false)
		}
	</script>
</body>
</html>